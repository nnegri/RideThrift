{% extends 'base.html' %}
{% block content %}

    <h1>Ride Thrift</h2>
    {% if session %}
        {% if session['lyft_depart_time'] != "" %}
            {% if session['minutes'] > 0 %}
                <h3>Your Lyft is on its way! Please be ready to depart in {{ session['minutes'] }} 
                {% if session['minutes'] == 1 %}
                    minute. 
                {% else %}
                    minutes. 
                {% endif %}
                You will arrive at your destination at {{ session['lyft_arrive_time'] }}.</h3>
            {% elif session['minutes'] == 0 %}
                <h3>Your Lyft has arrived! You will reach your destination at {{ session['lyft_arrive_time'] }}.</h3>
            {% elif session['minutes'] < 0 and session['minutes-arr'] > 0 %}
                <h3>Your are on your way! You will reach your destination in {{ session['minutes-arr'] }} 
                {% if session['minutes-arr'] == 1 %} 
                    minute, 
                {% else %} 
                    minutes, 
                {% endif %} 
                at {{ session['lyft_arrive_time'] }}.</h3>
            {% endif %}
        {% endif %}

        {% if session['uber_depart_time'] != "" %}
            {% if session['minutes'] > 0 %}
                <h3>Your Uber is on its way! Please be ready to depart in {{ session['minutes'] }} 
                {% if session['minutes'] == 1 %}
                    minute. 
                {% else %}
                    minutes. 
                {% endif %}
                You will arrive at your destination at {{ session['uber_arrive_time'] }}.</h3>
            {% elif session['minutes'] == 0 %}
                <h3>Your Uber has arrived! You will reach your destination at {{ session['uber_arrive_time'] }}.</h3>
            {% elif session['minutes'] < 0 and session['minutes-arr'] > 0 %}
                <h3>Your are on your way! You will reach your destination in {{ session['minutes-arr'] }} 
                {% if session['minutes-arr'] == 1 %}
                    minute, 
                {% else %}
                    minutes, 
                {% endif %}
                at {{ session['uber_arrive_time'] }}.</h3>
            {% endif %}
        {% endif %}

    {% endif %}

    <form id="estimate-form" method="post" action="/estimates.json">
        <label>Origin:</label>

        <input type="hidden" class="orig-lat-rides" name="origin-lat" id="orig-lat-est" value="origin"> 
        <input type="hidden" class="orig-lng-rides"name="origin-lng" id="orig-lng-est" value="origin">
        <input type="hidden" name="origin-lat-save" id="orig-lat-save">
        <input type="hidden" name="origin-lng-save" id="orig-lng-save">
        <input type="hidden" id="origin-address" name="origin-address">
        <input type="hidden" id="origin-name" name="origin-name">
        <div id="locationField">
            <input class = "auto" id="autocomplete-orig" placeholder="Enter your address"
             onFocus="geolocate()" type="text"></input>
            <span id="save-origin">Save Address: <input type="checkbox" name="origin" value="save" id="orig-check">
            Label: <input type="text" name="label-or" id="label-or"></span><br>
        </div>

        <button type="button" name="location" id="location">Current Location</button>
        {% if session %}
            <select name="origins" id="origin-drop">
                <option value="-">Saved Addresses
                {% for user_address in user.user_addresses %}
                    <option value="{{ user_address.address.address }}" data-lat="{{ user_address.address.latitude }}" data-lng="{{ user_address.address.longitude }}">{{ user_address.label }}
                {% endfor %}
            </select>
        {% endif %}
        <br>
        <label>Destination:</label>

        <input type="hidden" class="dest-lat-rides" name="dest-lat" id="dest-lat-est" value="dest"> 
        <input type="hidden" class="dest-lng-rides" name="dest-lng" id="dest-lng-est" value="dest">
        <input type="hidden" name="destn-lat-save" id="dest-lat-save">
        <input type="hidden" name="destn-lng-save" id="dest-lng-save">
        <input type="hidden" id="destn-address" name="destn-address">
        <input type="hidden" id="destn-name" name="destn-name">
        <div id="locationField">
            <input class = "auto" id="autocomplete-dest" placeholder="Enter your address"
             onFocus="geolocate()" type="text"></input>
            <span id="save-dest">Save Address: <input type="checkbox" name="dest" value="save" id="dest-check">
            Label: <input type="text" name="label-de" id="label-de"></span><br>
        </div>
        {% if session %}
            <select name="dests" id="dest-drop">
                <option value="-">Saved Addresses
                {% for user_address in user.user_addresses %}
                    <option value="{{ user_address.address.address }}" data-lat="{{ user_address.address.latitude }}" data-lng="{{ user_address.address.longitude }}">{{ user_address.label }}
                {% endfor %}
            </select>
        {% endif %}
        <br><input type="submit" value="Get Estimates"><br>    
    </form>
    
    <form action="/call_uber" method="POST">
        <input type="hidden" class="orig-lat-rides" name="origin-lat" id="orig-lat-uber" value="origin"> 
        <input type="hidden" class="orig-lng-rides" name="origin-lng" id="orig-lng-uber" value="origin">
        <input type="hidden" class="dest-lat-rides" name="dest-lat" id="dest-lat-uber" value="dest"> 
        <input type="hidden" class="dest-lng-rides" name="dest-lng" id="dest-lng-uber" value="dest">
        <input type="hidden" name="uber-ride-type" id="uber-ride-choice">
        <span id="uber"></span><br>
        <input class="rdo-uber" type="radio" name="uber-rdo" id="rdo-pool"> <label id="pool"></label><br>
        <input class="rdo-uber" type="radio" name="uber-rdo" id="rdo-uberx" checked="checked"> <label id="uberx"></label><br>
        <input class="rdo-uber" type="radio" name="uber-rdo" id="rdo-uberxl"> <label id="uberxl"></label><br>
        <input type="submit" value="Request Uber" id="uber-req-button">
    </form>

    <form action="/call_lyft" method="POST">
        <input type="hidden" class="orig-lat-rides" name="origin-lat" id="orig-lat-uber" value="origin"> 
        <input type="hidden" class="orig-lng-rides" name="origin-lng" id="orig-lng-uber" value="origin">
        <input type="hidden" class="dest-lat-rides" name="dest-lat" id="dest-lat-uber" value="dest"> 
        <input type="hidden" class="dest-lng-rides" name="dest-lng" id="dest-lng-uber" value="dest">
        <input type="hidden" name="lyft-ride-type" id="lyft-ride-choice">
        <span id="lyft"></span><br>
        <input class="rdo-lyft" type="radio" name="lyft-rdo" id="rdo-line"> <label id="line"></label><br>
        <input class="rdo-lyft" type="radio" name="lyft-rdo" id="rdo-lyft-lyft" checked="checked"> <label id="lyft-lyft"></label><br>
        <input class="rdo-lyft" type="radio" name="lyft-rdo" id="rdo-plus"> <label id="plus"></label><br>
        <input type="submit" value="Request Lyft" id="lyft-req-button">
    </form>


    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDONgg2Pw6W0awiwVNAVRD0HTK6Hzz2OA4&libraries=geometry,places&callback=initAutocomplete" async defer></script>
    <script src="/static/js/submit-addresses.js"></script>


{% endblock %}